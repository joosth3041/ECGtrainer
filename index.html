<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IC ECG Trainer Pro</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --bg-dark: #0a0a0f;
            --bg-card: #12121a;
            --bg-elevated: #1a1a25;
            --text-primary: #f0f0f0;
            --text-secondary: #888;
            --accent: #22c55e;
            --danger: #ef4444;
            --warning: #f59e0b;
            --info: #3b82f6;
            --border-color: #2a2a3a;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.5;
        }
        
        .app-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
        }
        
        header {
            text-align: center;
            padding: 1.5rem 0;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 1rem;
        }
        
        header h1 {
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
        }
        
        .stats-bar {
            display: flex;
            justify-content: center;
            gap: 2rem;
            flex-wrap: wrap;
            margin-top: 1rem;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--accent);
        }
        
        .stat-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }
        
        /* Navigation */
        .nav-tabs {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-bottom: 1.5rem;
            padding: 0.5rem;
            background: var(--bg-card);
            border-radius: 12px;
        }
        
        .nav-btn {
            padding: 0.75rem 1.25rem;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.95rem;
            transition: all 0.2s;
        }
        
        .nav-btn:hover {
            background: var(--bg-elevated);
            color: var(--text-primary);
        }
        
        .nav-btn.active {
            background: var(--accent);
            color: white;
        }
        
        /* Cards */
        .card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            border: 1px solid var(--border-color);
        }
        
        .card h2 {
            margin-bottom: 1rem;
            color: var(--accent);
        }
        
        .card h3 {
            margin-bottom: 0.75rem;
        }
        
        /* Tab Content */
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Buttons */
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .btn-primary {
            background: var(--info);
            color: white;
        }
        
        .btn-success {
            background: var(--accent);
            color: white;
        }
        
        .btn-danger {
            background: var(--danger);
            color: white;
        }
        
        .btn-secondary {
            background: var(--bg-elevated);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }
        
        .btn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }
        
        .btn-group {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
            margin-top: 1rem;
        }
        
        /* ECG Canvas */
        .ecg-canvas-container {
            background: #000;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
        }
        
        #monitorCanvas, #quizCanvas {
            width: 100%;
            height: 200px;
            display: block;
        }
        
        /* Vitals Display */
        .vitals-display {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .vital-box {
            background: var(--bg-elevated);
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
        }
        
        .vital-value {
            font-size: 2rem;
            font-weight: bold;
            font-family: 'Courier New', monospace;
        }
        
        .vital-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }
        
        /* Quiz Options */
        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        
        .quiz-option {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: var(--bg-elevated);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .quiz-option:hover {
            border-color: var(--info);
            background: rgba(59, 130, 246, 0.1);
        }
        
        .quiz-option.selected {
            border-color: var(--info);
            background: rgba(59, 130, 246, 0.2);
        }
        
        .quiz-option.correct {
            border-color: var(--accent);
            background: rgba(34, 197, 94, 0.2);
        }
        
        .quiz-option.incorrect {
            border-color: var(--danger);
            background: rgba(239, 68, 68, 0.2);
        }
        
        /* Feedback Panel */
        .feedback-panel {
            margin-top: 1rem;
            padding: 1rem;
            border-radius: 8px;
            display: none;
        }
        
        .feedback-panel.show {
            display: block;
        }
        
        .feedback-panel.correct {
            background: rgba(34, 197, 94, 0.15);
            border-left: 4px solid var(--accent);
        }
        
        .feedback-panel.incorrect {
            background: rgba(239, 68, 68, 0.15);
            border-left: 4px solid var(--danger);
        }
        
        /* Library Cards */
        .library-card {
            background: var(--bg-elevated);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            border-left: 4px solid var(--info);
        }
        
        .library-card h4 {
            color: var(--accent);
            margin-bottom: 0.5rem;
        }
        
        .library-card ul {
            margin-left: 1.5rem;
            margin-top: 0.5rem;
        }
        
        .library-card li {
            margin-bottom: 0.25rem;
        }
        
        /* Badge */
        .badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .badge-green { background: var(--accent); color: white; }
        .badge-yellow { background: var(--warning); color: black; }
        .badge-red { background: var(--danger); color: white; }
        .badge-blue { background: var(--info); color: white; }
        
        /* Grid */
        .grid-2 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
        }
        
        /* Filter Buttons */
        .filter-group {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
        }
        
        .filter-btn {
            padding: 0.5rem 1rem;
            border: 1px solid var(--border-color);
            background: var(--bg-elevated);
            color: var(--text-secondary);
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.85rem;
        }
        
        .filter-btn:hover, .filter-btn.active {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }
        
        /* ACLS Boxes */
        .acls-box {
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
        }
        
        .acls-box.critical {
            background: rgba(239, 68, 68, 0.15);
            border-left: 4px solid var(--danger);
        }
        
        .acls-box.warning {
            background: rgba(245, 158, 11, 0.15);
            border-left: 4px solid var(--warning);
        }
        
        .acls-box.info {
            background: rgba(59, 130, 246, 0.15);
            border-left: 4px solid var(--info);
        }
        
        .acls-box.success {
            background: rgba(34, 197, 94, 0.15);
            border-left: 4px solid var(--accent);
        }
        
        /* Responsive */
        @media (max-width: 600px) {
            .nav-tabs {
                justify-content: center;
            }
            
            .nav-btn {
                padding: 0.5rem 0.75rem;
                font-size: 0.85rem;
            }
            
            .vital-value {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <header>
            <h1>ü´Ä IC ECG Trainer Pro</h1>
            <p style="color: var(--text-secondary);">Interactieve ECG training voor IC-verpleegkundigen</p>
            <div class="stats-bar">
                <div class="stat-item">
                    <div class="stat-value" id="xpDisplay">0</div>
                    <div class="stat-label">XP</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="levelDisplay">1</div>
                    <div class="stat-label">Level</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="streakDisplay">0</div>
                    <div class="stat-label">Streak üî•</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="accuracyDisplay">0%</div>
                    <div class="stat-label">Score</div>
                </div>
            </div>
        </header>
        
        <nav class="nav-tabs">
            <button class="nav-btn active" onclick="showTab('dashboard')">üè† Dashboard</button>
            <button class="nav-btn" onclick="showTab('monitor')">üì∫ Monitor</button>
            <button class="nav-btn" onclick="showTab('quiz')">‚ùì Quiz</button>
            <button class="nav-btn" onclick="showTab('library')">üìö Bibliotheek</button>
            <button class="nav-btn" onclick="showTab('acls')">üö® ACLS</button>
        </nav>
        
        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <div class="card">
                <h2>üëã Welkom!</h2>
                <p>Train je ECG-herkenning met deze interactieve tool. Kies een onderdeel om te beginnen:</p>
                
                <div class="grid-2" style="margin-top: 1.5rem;">
                    <div class="card" style="cursor: pointer; border-left: 4px solid var(--accent);" onclick="showTab('monitor')">
                        <h3>üì∫ Live Monitor</h3>
                        <p style="color: var(--text-secondary);">Bekijk real-time ECG simulaties met vitale parameters</p>
                    </div>
                    <div class="card" style="cursor: pointer; border-left: 4px solid var(--info);" onclick="showTab('quiz')">
                        <h3>‚ùì Quiz Mode</h3>
                        <p style="color: var(--text-secondary);">Test je kennis met willekeurige ECG vragen</p>
                    </div>
                    <div class="card" style="cursor: pointer; border-left: 4px solid var(--warning);" onclick="showTab('library')">
                        <h3>üìö Bibliotheek</h3>
                        <p style="color: var(--text-secondary);">Alle ECG patronen met uitleg en behandeling</p>
                    </div>
                    <div class="card" style="cursor: pointer; border-left: 4px solid var(--danger);" onclick="showTab('acls')">
                        <h3>üö® ACLS Protocols</h3>
                        <p style="color: var(--text-secondary);">Noodprotocollen voor hartstilstand en aritmie√´n</p>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h2>üìä Snelle Referentie</h2>
                <div class="grid-2">
                    <div>
                        <h4 style="color: var(--danger); margin-bottom: 0.5rem;">üö® STEMI Lokalisatie</h4>
                        <ul style="margin-left: 1.5rem; color: var(--text-secondary);">
                            <li><strong>Anterior:</strong> V1-V4 (LAD)</li>
                            <li><strong>Inferior:</strong> II, III, aVF (RCA/LCx)</li>
                            <li><strong>Lateral:</strong> I, aVL, V5-V6</li>
                            <li><strong>Posterior:</strong> V7-V9 (spiegelbeeld V1-V3)</li>
                        </ul>
                    </div>
                    <div>
                        <h4 style="color: var(--warning); margin-bottom: 0.5rem;">‚ö†Ô∏è Kritieke Waarden</h4>
                        <ul style="margin-left: 1.5rem; color: var(--text-secondary);">
                            <li><strong>K+ >6.5:</strong> ECG veranderingen, behandel!</li>
                            <li><strong>QTc >500ms:</strong> Torsades risico</li>
                            <li><strong>Nieuw LBBB:</strong> Kan STEMI equivalent zijn</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Monitor Tab -->
        <div id="monitor" class="tab-content">
            <div class="card">
                <h2>üì∫ Live ECG Monitor</h2>
                
                <div class="btn-group" style="margin-bottom: 1rem;">
                    <button class="btn btn-success" onclick="setRhythm('normal')">Normaal</button>
                    <button class="btn btn-primary" onclick="setRhythm('afib')">AF</button>
                    <button class="btn btn-warning" onclick="setRhythm('vt')">VT</button>
                    <button class="btn btn-danger" onclick="setRhythm('vf')">VF</button>
                    <button class="btn btn-secondary" onclick="setRhythm('avblock3')">3e AV-blok</button>
                    <button class="btn btn-secondary" onclick="setRhythm('stemi')">STEMI</button>
                </div>
                
                <div class="ecg-canvas-container">
                    <canvas id="monitorCanvas"></canvas>
                </div>
                
                <div class="vitals-display">
                    <div class="vital-box">
                        <div class="vital-value" id="hrDisplay" style="color: #22c55e;">72</div>
                        <div class="vital-label">HR (bpm)</div>
                    </div>
                    <div class="vital-box">
                        <div class="vital-value" id="bpDisplay" style="color: #ef4444;">120/80</div>
                        <div class="vital-label">BP (mmHg)</div>
                    </div>
                    <div class="vital-box">
                        <div class="vital-value" id="spo2Display" style="color: #3b82f6;">98</div>
                        <div class="vital-label">SpO2 (%)</div>
                    </div>
                    <div class="vital-box">
                        <div class="vital-value" id="rrDisplay" style="color: #f59e0b;">14</div>
                        <div class="vital-label">RR (/min)</div>
                    </div>
                </div>
                
                <div id="rhythmInfo" class="library-card" style="margin-top: 1rem;">
                    <h4>Normaal Sinusritme</h4>
                    <p>Frequentie 60-100/min, regelmatig ritme met P-golf voor elk QRS-complex.</p>
                </div>
            </div>
        </div>
        
        <!-- Quiz Tab -->
        <div id="quiz" class="tab-content">
            <div class="card">
                <h2>‚ùì ECG Quiz</h2>
                
                <div class="btn-group" style="margin-bottom: 1rem;">
                    <button class="btn btn-success" onclick="setDifficulty('easy')">Makkelijk</button>
                    <button class="btn btn-primary" onclick="setDifficulty('medium')">Gemiddeld</button>
                    <button class="btn btn-danger" onclick="setDifficulty('hard')">Moeilijk</button>
                </div>
                
                <div class="ecg-canvas-container">
                    <canvas id="quizCanvas"></canvas>
                </div>
                
                <h3 style="margin: 1rem 0;">Welk ritme zie je?</h3>
                
                <div id="quizOptions" class="quiz-options">
                    <!-- Options worden hier geladen -->
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-success" onclick="checkAnswer()">‚úì Check Antwoord</button>
                    <button class="btn btn-primary" onclick="nextQuestion()">‚Üí Volgende</button>
                </div>
                
                <div id="quizFeedback" class="feedback-panel"></div>
            </div>
        </div>
        
        <!-- Library Tab -->
        <div id="library" class="tab-content">
            <div class="card">
                <h2>üìö ECG Bibliotheek</h2>
                
                <div class="filter-group">
                    <button class="filter-btn active" onclick="filterLibrary('all')">Alle</button>
                    <button class="filter-btn" onclick="filterLibrary('aritmie')">Aritmie√´n</button>
                    <button class="filter-btn" onclick="filterLibrary('blok')">AV-blokken</button>
                    <button class="filter-btn" onclick="filterLibrary('ischemie')">Ischemie</button>
                    <button class="filter-btn" onclick="filterLibrary('elektrolyt')">Elektrolyten</button>
                </div>
                
                <div id="libraryContent">
                    <!-- Content wordt hier geladen -->
                </div>
            </div>
        </div>
        
        <!-- ACLS Tab -->
        <div id="acls" class="tab-content">
            <div class="card">
                <h2>üö® ACLS Protocollen</h2>
                
                <div class="btn-group" style="margin-bottom: 1.5rem;">
                    <button class="btn btn-danger" onclick="showACLS('arrest')">Hartstilstand</button>
                    <button class="btn btn-warning" onclick="showACLS('tachy')">Tachycardie</button>
                    <button class="btn btn-info" onclick="showACLS('brady')">Bradycardie</button>
                </div>
                
                <div id="aclsContent">
                    <!-- ACLS content wordt hier geladen -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // ========== STATE ==========
        let state = {
            xp: 0,
            level: 1,
            streak: 0,
            correct: 0,
            total: 0,
            currentRhythm: 'normal',
            currentQuiz: null,
            difficulty: 'medium',
            libraryFilter: 'all'
        };
        
        // Load state from localStorage
        function loadState() {
            const saved = localStorage.getItem('ecgTrainerState');
            if (saved) {
                try {
                    const parsed = JSON.parse(saved);
                    state = { ...state, ...parsed };
                } catch(e) {}
            }
            updateStats();
        }
        
        // Save state
        function saveState() {
            localStorage.setItem('ecgTrainerState', JSON.stringify(state));
        }
        
        // Update stats display
        function updateStats() {
            document.getElementById('xpDisplay').textContent = state.xp;
            document.getElementById('levelDisplay').textContent = Math.floor(state.xp / 100) + 1;
            document.getElementById('streakDisplay').textContent = state.streak;
            const accuracy = state.total > 0 ? Math.round((state.correct / state.total) * 100) : 0;
            document.getElementById('accuracyDisplay').textContent = accuracy + '%';
        }
        
        // ========== NAVIGATION ==========
        function showTab(tabId) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active from all nav buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabId).classList.add('active');
            
            // Find and activate the correct nav button
            document.querySelectorAll('.nav-btn').forEach(btn => {
                if (btn.textContent.toLowerCase().includes(tabId.substring(0, 4)) || 
                    (tabId === 'dashboard' && btn.textContent.includes('Dashboard'))) {
                    btn.classList.add('active');
                }
            });
            
            // Initialize tab content
            if (tabId === 'monitor') {
                initMonitor();
            } else if (tabId === 'quiz') {
                nextQuestion();
            } else if (tabId === 'library') {
                renderLibrary();
            } else if (tabId === 'acls') {
                showACLS('arrest');
            }
        }
        
        // ========== ECG DATA ==========
        const ecgPatterns = {
            normal: {
                name: 'Normaal Sinusritme',
                hr: 72,
                description: 'Regelmatig ritme, 60-100/min, P-golf voor elk QRS',
                criteria: ['HR 60-100/min', 'Regelmatig', 'P-golf positief in II', 'PR 120-200ms', 'QRS <120ms'],
                treatment: ['Geen behandeling nodig'],
                difficulty: 'easy'
            },
            sinusBrady: {
                name: 'Sinusbradycardie',
                hr: 45,
                description: 'Sinusritme met frequentie <60/min',
                criteria: ['HR <60/min', 'Normale P-golven', 'Regelmatig'],
                treatment: ['Asymptomatisch: observatie', 'Symptomatisch: Atropine 0.5-1mg IV'],
                difficulty: 'easy'
            },
            sinusTachy: {
                name: 'Sinustachycardie',
                hr: 120,
                description: 'Sinusritme met frequentie >100/min',
                criteria: ['HR >100/min', 'Normale P-golven', 'Regelmatig'],
                treatment: ['Behandel de oorzaak!', 'NIET de tachycardie zelf'],
                difficulty: 'easy'
            },
            afib: {
                name: 'Atriumfibrilleren',
                hr: 95,
                description: 'Onregelmatig ritme zonder P-golven, fibrillatiegolven',
                criteria: ['Onregelmatig onregelmatig', 'Geen P-golven', 'Fibrillatiegolven'],
                treatment: ['Rate control: metoprolol/diltiazem', 'Anticoagulatie (CHA2DS2-VASc)', 'Instabiel: cardioversie'],
                difficulty: 'easy'
            },
            aflutter: {
                name: 'Atriumflutter',
                hr: 150,
                description: 'Zaagtand flutter-golven, meestal 2:1 blok',
                criteria: ['Zaagtand F-golven ~300/min', 'Meestal HR ~150 (2:1)', 'Best zichtbaar in II, III, aVF'],
                treatment: ['Rate control moeilijk', 'Cardioversie effectief', 'Ablatie zeer succesvol'],
                difficulty: 'medium'
            },
            svt: {
                name: 'SVT (AVNRT)',
                hr: 180,
                description: 'Smalle tachycardie, abrupt begin/einde',
                criteria: ['Smal QRS', 'Regelmatig', 'HR 150-250', 'Geen/verborgen P-golven'],
                treatment: ['Vagale manoeuvres', 'Adenosine 6-12-12mg', 'Instabiel: cardioversie'],
                difficulty: 'medium'
            },
            vt: {
                name: 'Ventriculaire Tachycardie',
                hr: 180,
                description: 'Brede QRS tachycardie uit ventrikels - GEVAARLIJK',
                criteria: ['Breed QRS >120ms', 'HR >100', 'AV-dissociatie', 'Capture/fusion beats'],
                treatment: ['INSTABIEL: cardioversie!', 'Stabiel: Amiodaron 150mg IV', 'GEEN adenosine/verapamil!'],
                difficulty: 'hard'
            },
            vf: {
                name: 'Ventrikelfibrilleren',
                hr: 0,
                description: 'Chaotisch ritme - HARTSTILSTAND',
                criteria: ['Chaotisch, geen QRS herkenbaar', 'Geen output'],
                treatment: ['üö® START CPR!', 'Defibrilleer 200J', 'Adrenaline na 2e shock', 'Amiodaron na 3e shock'],
                difficulty: 'hard'
            },
            avblock1: {
                name: 'Eerstegraads AV-blok',
                hr: 65,
                description: 'PR-interval >200ms, alle P-golven geleiden',
                criteria: ['PR >200ms', 'Constante PR', 'Elke P gevolgd door QRS'],
                treatment: ['Meestal geen behandeling', 'Monitor voor progressie'],
                difficulty: 'easy'
            },
            avblock2type1: {
                name: 'Tweedegraads AV-blok Type I (Wenckebach)',
                hr: 55,
                description: 'Progressieve PR-verlenging tot dropped beat',
                criteria: ['PR wordt steeds langer', 'Dan valt QRS uit', 'Groepsgewijs patroon'],
                treatment: ['Meestal benigne', 'Zelden pacemaker nodig'],
                difficulty: 'medium'
            },
            avblock2type2: {
                name: 'Tweedegraads AV-blok Type II (Mobitz)',
                hr: 45,
                description: 'Plotseling dropped beat zonder PR-verlenging - ERNSTIG',
                criteria: ['Constante PR', 'Plotseling QRS uit', 'Vaak breed QRS'],
                treatment: ['‚ö†Ô∏è Hoog risico!', 'Pacemaker indicatie', 'Atropine werkt vaak niet'],
                difficulty: 'medium'
            },
            avblock3: {
                name: 'Compleet AV-blok (3e graads)',
                hr: 35,
                description: 'Geen AV-geleiding, P en QRS onafhankelijk - URGENT',
                criteria: ['Complete AV-dissociatie', 'P-frequentie > QRS-frequentie', 'Regelmatig PP √©n RR'],
                treatment: ['üö® URGENT!', 'Atropine 0.5-1mg', 'Transcutane pacing', 'Permanente pacemaker'],
                difficulty: 'hard'
            },
            stemi: {
                name: 'STEMI',
                hr: 85,
                description: 'ST-elevatie myocardinfarct - TIJD = HARTSPIER',
                criteria: ['ST-elevatie ‚â•2mm V2-V3', 'of ‚â•1mm andere afleidingen', 'In ‚â•2 aangrenzende afleidingen'],
                treatment: ['üö® Cath lab activeren!', 'Aspirine 300mg', 'P2Y12 remmer', 'Heparine', 'PCI <120 min'],
                difficulty: 'hard'
            },
            hyperK: {
                name: 'Hyperkali√´mie',
                hr: 50,
                description: 'Hoog kalium - hoge T-golven, brede QRS',
                criteria: ['Hoge, spitse T-golven (tent)', 'PR-verlenging', 'QRS-verbreding', 'Sinusgolf patroon'],
                treatment: ['Calcium gluconaat EERST', 'Insuline + glucose', 'Salbutamol', 'Dialyse'],
                difficulty: 'hard'
            },
            hypoK: {
                name: 'Hypokali√´mie',
                hr: 75,
                description: 'Laag kalium - vlakke T, prominente U-golf',
                criteria: ['Vlakke/ge√Ønverteerde T', 'Prominente U-golf', 'ST-depressie', 'QT-verlenging'],
                treatment: ['K+ suppletie', 'Ook Mg corrigeren', 'Cave: digoxine toxiciteit'],
                difficulty: 'medium'
            }
        };
        
        // ========== MONITOR ==========
        let monitorAnimation = null;
        let ecgPosition = 0;
        
        function initMonitor() {
            const canvas = document.getElementById('monitorCanvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width * 2;
            canvas.height = rect.height * 2;
            ctx.scale(2, 2);
            
            if (monitorAnimation) {
                cancelAnimationFrame(monitorAnimation);
            }
            
            ecgPosition = 0;
            animateMonitor();
        }
        
        function animateMonitor() {
            const canvas = document.getElementById('monitorCanvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width / 2;
            const height = canvas.height / 2;
            
            // Clear
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, width, height);
            
            // Draw grid
            ctx.strokeStyle = '#1a3a1a';
            ctx.lineWidth = 0.5;
            for (let x = 0; x < width; x += 20) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, height);
                ctx.stroke();
            }
            for (let y = 0; y < height; y += 20) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(width, y);
                ctx.stroke();
            }
            
            // Draw ECG
            ctx.strokeStyle = '#22c55e';
            ctx.lineWidth = 2;
            ctx.beginPath();
            
            const baseline = height / 2;
            const rhythm = ecgPatterns[state.currentRhythm];
            const cycleLength = rhythm.hr > 0 ? Math.floor(3000 / rhythm.hr) : 300;
            
            for (let x = 0; x < width; x++) {
                const t = (x + ecgPosition) % cycleLength;
                let y = baseline;
                
                if (state.currentRhythm === 'vf') {
                    y = baseline + (Math.random() - 0.5) * 80;
                } else if (state.currentRhythm === 'afib') {
                    y = baseline + (Math.random() - 0.5) * 5;
                    if (Math.random() < 0.02) {
                        y = baseline - 40 + Math.random() * 10;
                    }
                } else {
                    // Normal-ish waveforms
                    const phase = t / cycleLength;
                    
                    // P wave
                    if (phase > 0.1 && phase < 0.2) {
                        const p = (phase - 0.1) / 0.1;
                        y = baseline - 10 * Math.sin(p * Math.PI);
                    }
                    // QRS
                    else if (phase > 0.25 && phase < 0.35) {
                        const q = (phase - 0.25) / 0.1;
                        if (q < 0.2) y = baseline + 10;
                        else if (q < 0.5) y = baseline - 60;
                        else if (q < 0.8) y = baseline + 20;
                        else y = baseline;
                    }
                    // T wave
                    else if (phase > 0.45 && phase < 0.6) {
                        const tw = (phase - 0.45) / 0.15;
                        y = baseline - 15 * Math.sin(tw * Math.PI);
                    }
                    
                    // Modifications per rhythm
                    if (state.currentRhythm === 'stemi' && phase > 0.35 && phase < 0.45) {
                        y = baseline - 25;
                    }
                    if (state.currentRhythm === 'hyperK' && phase > 0.45 && phase < 0.6) {
                        const tw = (phase - 0.45) / 0.15;
                        y = baseline - 35 * Math.sin(tw * Math.PI);
                    }
                }
                
                if (state.currentRhythm === 'vt') {
                    const phase = (t % 80) / 80;
                    if (phase < 0.5) y = baseline - 50;
                    else y = baseline + 50;
                }
                
                if (x === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.stroke();
            
            // Sweep line
            const sweepX = ecgPosition % width;
            ctx.strokeStyle = 'rgba(34, 197, 94, 0.5)';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(sweepX, 0);
            ctx.lineTo(sweepX, height);
            ctx.stroke();
            
            ecgPosition += 2;
            monitorAnimation = requestAnimationFrame(animateMonitor);
        }
        
        function setRhythm(rhythm) {
            state.currentRhythm = rhythm;
            const pattern = ecgPatterns[rhythm];
            
            // Update vitals display
            document.getElementById('hrDisplay').textContent = pattern.hr;
            document.getElementById('hrDisplay').style.color = pattern.hr === 0 ? '#ef4444' : 
                pattern.hr > 100 ? '#f59e0b' : pattern.hr < 50 ? '#f59e0b' : '#22c55e';
            
            // Update info box
            const infoBox = document.getElementById('rhythmInfo');
            infoBox.innerHTML = `
                <h4>${pattern.name}</h4>
                <p>${pattern.description}</p>
                <h5 style="margin-top: 0.75rem;">Criteria:</h5>
                <ul>${pattern.criteria.map(c => `<li>${c}</li>`).join('')}</ul>
                <h5 style="margin-top: 0.75rem; color: var(--accent);">Behandeling:</h5>
                <ul>${pattern.treatment.map(t => `<li>${t}</li>`).join('')}</ul>
            `;
        }
        
        // ========== QUIZ ==========
        let quizAnswer = null;
        let selectedOption = null;
        
        function setDifficulty(diff) {
            state.difficulty = diff;
            nextQuestion();
        }
        
        function nextQuestion() {
            // Filter by difficulty
            const patterns = Object.entries(ecgPatterns).filter(([key, p]) => {
                if (state.difficulty === 'easy') return p.difficulty === 'easy';
                if (state.difficulty === 'medium') return p.difficulty !== 'hard';
                return true;
            });
            
            // Pick random correct answer
            const randomIndex = Math.floor(Math.random() * patterns.length);
            const [correctKey, correctPattern] = patterns[randomIndex];
            quizAnswer = correctKey;
            selectedOption = null;
            
            // Draw quiz ECG
            drawQuizECG(correctKey);
            
            // Generate options
            const wrongOptions = patterns
                .filter(([key]) => key !== correctKey)
                .sort(() => Math.random() - 0.5)
                .slice(0, 3);
            
            const allOptions = [[correctKey, correctPattern], ...wrongOptions]
                .sort(() => Math.random() - 0.5);
            
            // Render options
            const optionsDiv = document.getElementById('quizOptions');
            optionsDiv.innerHTML = allOptions.map(([key, pattern], i) => `
                <div class="quiz-option" onclick="selectQuizOption('${key}', this)">
                    <span style="width: 24px; height: 24px; border: 2px solid var(--border-color);
                                 border-radius: 50%; display: flex; align-items: center;
                                 justify-content: center;">${String.fromCharCode(65 + i)}</span>
                    <span>${pattern.name}</span>
                </div>
            `).join('');
            
            // Clear feedback
            document.getElementById('quizFeedback').className = 'feedback-panel';
            document.getElementById('quizFeedback').innerHTML = '';
        }
        
        function drawQuizECG(rhythmKey) {
            const canvas = document.getElementById('quizCanvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width * 2;
            canvas.height = rect.height * 2;
            ctx.scale(2, 2);
            
            const width = rect.width;
            const height = rect.height;
            
            // Clear
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, width, height);
            
            // Grid
            ctx.strokeStyle = '#1a3a1a';
            ctx.lineWidth = 0.5;
            for (let x = 0; x < width; x += 20) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, height);
                ctx.stroke();
            }
            for (let y = 0; y < height; y += 20) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(width, y);
                ctx.stroke();
            }
            
            // Draw static ECG
            ctx.strokeStyle = '#22c55e';
            ctx.lineWidth = 2;
            ctx.beginPath();
            
            const baseline = height / 2;
            const pattern = ecgPatterns[rhythmKey];
            const cycleLength = pattern.hr > 0 ? Math.floor(3000 / pattern.hr) : 200;
            
            for (let x = 0; x < width; x++) {
                const t = x % cycleLength;
                let y = baseline;
                
                if (rhythmKey === 'vf') {
                    y = baseline + (Math.random() - 0.5) * 60;
                } else if (rhythmKey === 'afib') {
                    y = baseline + (Math.random() - 0.5) * 3;
                    if (Math.random() < 0.015) y = baseline - 35;
                } else if (rhythmKey === 'vt') {
                    const phase = (t % 80) / 80;
                    y = phase < 0.5 ? baseline - 45 : baseline + 45;
                } else {
                    const phase = t / cycleLength;
                    if (phase > 0.1 && phase < 0.2) {
                        y = baseline - 8 * Math.sin((phase - 0.1) / 0.1 * Math.PI);
                    } else if (phase > 0.25 && phase < 0.35) {
                        const q = (phase - 0.25) / 0.1;
                        if (q < 0.2) y = baseline + 8;
                        else if (q < 0.5) y = baseline - 50;
                        else if (q < 0.8) y = baseline + 15;
                    } else if (phase > 0.45 && phase < 0.6) {
                        y = baseline - 12 * Math.sin((phase - 0.45) / 0.15 * Math.PI);
                    }
                    
                    if (rhythmKey === 'stemi' && phase > 0.35 && phase < 0.45) y = baseline - 20;
                    if (rhythmKey === 'hyperK' && phase > 0.45 && phase < 0.6) {
                        y = baseline - 30 * Math.sin((phase - 0.45) / 0.15 * Math.PI);
                    }
                }
                
                if (x === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.stroke();
        }
        
        function selectQuizOption(key, element) {
            document.querySelectorAll('#quizOptions .quiz-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            element.classList.add('selected');
            selectedOption = key;
        }
        
        function checkAnswer() {
            if (!selectedOption) {
                alert('Selecteer eerst een antwoord!');
                return;
            }
            
            const correct = selectedOption === quizAnswer;
            const pattern = ecgPatterns[quizAnswer];
            
            // Show correct/incorrect on options
            document.querySelectorAll('#quizOptions .quiz-option').forEach(opt => {
                const optionKey = opt.onclick.toString().match(/'([^']+)'/)[1];
                if (optionKey === quizAnswer) {
                    opt.classList.add('correct');
                } else if (opt.classList.contains('selected')) {
                    opt.classList.add('incorrect');
                }
            });
            
            const feedback = document.getElementById('quizFeedback');
            
            if (correct) {
                state.correct++;
                state.streak++;
                state.xp += state.streak >= 5 ? 15 : 10;
                
                feedback.className = 'feedback-panel correct show';
                feedback.innerHTML = `
                    <h4>‚úì Correct! +${state.streak >= 5 ? 15 : 10} XP ${state.streak >= 5 ? 'üî•' : ''}</h4>
                    <p><strong>${pattern.name}</strong></p>
                    <p>${pattern.description}</p>
                `;
            } else {
                state.streak = 0;
                
                feedback.className = 'feedback-panel incorrect show';
                feedback.innerHTML = `
                    <h4>‚úó Helaas!</h4>
                    <p>Het juiste antwoord is: <strong>${pattern.name}</strong></p>
                    <p>${pattern.description}</p>
                    <h5 style="margin-top: 0.5rem;">Kenmerken:</h5>
                    <ul>${pattern.criteria.map(c => `<li>${c}</li>`).join('')}</ul>
                `;
            }
            
            state.total++;
            saveState();
            updateStats();
        }
        
        // ========== LIBRARY ==========
        function renderLibrary() {
            const container = document.getElementById('libraryContent');
            
            const filtered = Object.entries(ecgPatterns).filter(([key, p]) => {
                if (state.libraryFilter === 'all') return true;
                if (state.libraryFilter === 'aritmie') return ['afib', 'aflutter', 'svt', 'vt', 'vf'].includes(key);
                if (state.libraryFilter === 'blok') return key.includes('avblock');
                if (state.libraryFilter === 'ischemie') return key === 'stemi';
                if (state.libraryFilter === 'elektrolyt') return ['hyperK', 'hypoK'].includes(key);
                return true;
            });
            
            container.innerHTML = filtered.map(([key, pattern]) => `
                <div class="library-card" style="border-left-color: ${
                    pattern.difficulty === 'hard' ? 'var(--danger)' : 
                    pattern.difficulty === 'medium' ? 'var(--warning)' : 'var(--accent)'
                }">
                    <div style="display: flex; justify-content: space-between; align-items: start;">
                        <h4>${pattern.name}</h4>
                        <span class="badge badge-${
                            pattern.difficulty === 'hard' ? 'red' : 
                            pattern.difficulty === 'medium' ? 'yellow' : 'green'
                        }">${pattern.difficulty}</span>
                    </div>
                    <p style="color: var(--text-secondary); margin: 0.5rem 0;">${pattern.description}</p>
                    <h5>ECG Criteria:</h5>
                    <ul>${pattern.criteria.map(c => `<li>${c}</li>`).join('')}</ul>
                    <h5 style="color: var(--accent); margin-top: 0.75rem;">Behandeling:</h5>
                    <ul>${pattern.treatment.map(t => `<li>${t}</li>`).join('')}</ul>
                </div>
            `).join('');
        }
        
        function filterLibrary(filter) {
            state.libraryFilter = filter;
            
            // Update filter buttons
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.textContent.toLowerCase().includes(filter) || 
                    (filter === 'all' && btn.textContent === 'Alle')) {
                    btn.classList.add('active');
                }
            });
            
            renderLibrary();
        }
        
        // ========== ACLS ==========
        function showACLS(protocol) {
            const container = document.getElementById('aclsContent');
            
            if (protocol === 'arrest') {
                container.innerHTML = `
                    <div class="acls-box critical">
                        <h3>üö® Hartstilstand Algoritme</h3>
                        <ol>
                            <li><strong>Start CPR</strong> - 30:2, 100-120/min, 5-6cm diep</li>
                            <li><strong>Roep hulp</strong> - Activeer reanimatieteam</li>
                            <li><strong>Ritme check</strong></li>
                        </ol>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="acls-box" style="background: rgba(239,68,68,0.2); border-left: 4px solid var(--danger);">
                            <h4>‚ö° SHOCKBAAR (VF/pVT)</h4>
                            <ol>
                                <li>Defibrilleer 200J</li>
                                <li>CPR 2 min</li>
                                <li>Na 2e shock: Adrenaline 1mg</li>
                                <li>Na 3e shock: Amiodaron 300mg</li>
                            </ol>
                        </div>
                        <div class="acls-box" style="background: rgba(59,130,246,0.2); border-left: 4px solid var(--info);">
                            <h4>üíî NIET-SHOCKBAAR (Asystolie/PEA)</h4>
                            <ol>
                                <li>CPR 2 min</li>
                                <li>Adrenaline 1mg DIRECT</li>
                                <li>Herhaal elke 3-5 min</li>
                                <li>Zoek oorzaak (4H/4T)</li>
                            </ol>
                        </div>
                    </div>
                    
                    <div class="acls-box info">
                        <h4>üîç Reversibele Oorzaken</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <div>
                                <strong>4 H's:</strong>
                                <ul>
                                    <li>Hypoxie</li>
                                    <li>Hypovolemie</li>
                                    <li>Hypo/hyperkali√´mie</li>
                                    <li>Hypothermie</li>
                                </ul>
                            </div>
                            <div>
                                <strong>4 T's:</strong>
                                <ul>
                                    <li>Trombose (coronair)</li>
                                    <li>Trombose (pulmonaal)</li>
                                    <li>Tamponnade</li>
                                    <li>Tensie pneumothorax</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                `;
            } else if (protocol === 'tachy') {
                container.innerHTML = `
                    <div class="acls-box warning">
                        <h3>üíì Tachycardie Algoritme</h3>
                        <p><strong>Eerst: Is de pati√´nt stabiel?</strong></p>
                        <p>Instabiel = shock, syncope, ischemie, hartfalen</p>
                    </div>
                    
                    <div class="acls-box critical">
                        <h4>‚ö° INSTABIEL ‚Üí Direct Cardioversie!</h4>
                        <ul>
                            <li>Smal QRS: 70-120J</li>
                            <li>Breed QRS: 120-200J</li>
                        </ul>
                    </div>
                    
                    <div class="acls-box info">
                        <h4>Stabiel - Smal QRS (&lt;120ms)</h4>
                        <p><strong>Regelmatig (SVT):</strong></p>
                        <ol>
                            <li>Vagale manoeuvres</li>
                            <li>Adenosine 6mg ‚Üí 12mg ‚Üí 12mg</li>
                            <li>Verapamil of diltiazem</li>
                        </ol>
                        <p><strong>Onregelmatig (AF):</strong></p>
                        <ul>
                            <li>Rate control (metoprolol/diltiazem)</li>
                            <li>Anticoagulatie!</li>
                        </ul>
                    </div>
                    
                    <div class="acls-box" style="border-left: 4px solid var(--danger);">
                        <h4>Stabiel - Breed QRS (‚â•120ms)</h4>
                        <p><strong>‚ö†Ô∏è Behandel als VT tot tegendeel bewezen!</strong></p>
                        <ul>
                            <li>Amiodaron 150mg IV in 10 min</li>
                            <li>Of cardioversie</li>
                            <li>GEEN adenosine/verapamil bij onzekerheid!</li>
                        </ul>
                    </div>
                `;
            } else if (protocol === 'brady') {
                container.innerHTML = `
                    <div class="acls-box info">
                        <h3>üê¢ Bradycardie Algoritme</h3>
                        <p><strong>Is de pati√´nt symptomatisch?</strong></p>
                        <p>Hypotensie, veranderd bewustzijn, ischemie, shock</p>
                    </div>
                    
                    <div class="acls-box success">
                        <h4>Asymptomatisch</h4>
                        <ul>
                            <li>Observeer</li>
                            <li>Zoek oorzaak</li>
                            <li>Monitor voor progressie</li>
                        </ul>
                    </div>
                    
                    <div class="acls-box warning">
                        <h4>Symptomatisch - Behandeling</h4>
                        <ol>
                            <li><strong>Atropine 500mcg IV</strong>
                                <ul>
                                    <li>Herhaal elke 3-5 min</li>
                                    <li>Max 3mg totaal</li>
                                </ul>
                            </li>
                            <li><strong>Als atropine faalt:</strong>
                                <ul>
                                    <li>Transcutane pacing</li>
                                    <li>Adrenaline 2-10 mcg/min</li>
                                    <li>Isoprenaline</li>
                                </ul>
                            </li>
                            <li><strong>Transveneuze pacing regelen</strong></li>
                        </ol>
                    </div>
                    
                    <div class="acls-box" style="border-left: 4px solid var(--danger);">
                        <h4>‚ö†Ô∏è Let op bij AV-blokken</h4>
                        <ul>
                            <li>Mobitz II en compleet blok: atropine werkt vaak NIET</li>
                            <li>Direct pacing voorbereiden!</li>
                            <li>Pacemaker indicatie</li>
                        </ul>
                    </div>
                `;
            }
        }
        
        // ========== INIT ==========
        document.addEventListener('DOMContentLoaded', function() {
            loadState();
            console.log('ü´Ä IC ECG Trainer Pro geladen!');
        });
    </script>
</body>
</html>